---
import { getCollection, getEntry } from 'astro:content';
import Author from '@/components/ui/Author.astro';
import Container from '@/components/Container.astro';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { DEFAULT_CONFIGURATION } from '@/lib/constants';
import { Image } from 'astro:assets';

const entry = await getEntry('pages', 'shop');
const products = await getCollection('products');
const availableProducts = products.filter(p => p.data.available);
---

<BaseLayout seo={entry.data.seo}>
  <Container as='section' class='py-6'>
    <Author {...DEFAULT_CONFIGURATION.author} />
  </Container>

  <Container as='section' class='py-6'>
    <div class="flex flex-col gap-5">
      <div class="flex flex-col gap-2">
        <span class="text-headings">Digital Tools I've Built</span>
        <p class="text-muted-foreground text-sm max-w-2xl">
          Templates, frameworks, and resources I use daily. Get instant access after purchaseâ€”no shipping, no waiting.
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-3">
        {availableProducts.map((product) => (
          <article class="group flex flex-col">
            <a href={`/shop/${product.id}`} class="block">
              <div class="aspect-[4/3] rounded-lg bg-muted-foreground/5 border border-border mb-4 flex items-center justify-center overflow-hidden transition-all duration-300 group-hover:border-foreground/20 group-hover:bg-muted-foreground/10">
                {product.data.image ? (
                  <Image
                    src={product.data.image}
                    alt={product.data.title}
                    class="w-full h-full object-cover"
                    width={600}
                    height={450}
                  />
                ) : (
                  <div class="flex flex-col items-center gap-2">
                    <div class="w-16 h-16 rounded-full bg-muted-foreground/10 flex items-center justify-center">
                      <span class="text-2xl">ðŸ“¦</span>
                    </div>
                    <span class="text-muted-foreground text-sm">Coming soon</span>
                  </div>
                )}
              </div>

              <div class="flex items-start justify-between gap-4 mb-2">
                <h3 class="text-headings font-medium text-lg group-hover:text-foreground transition-colors">
                  {product.data.title}
                </h3>
                <span class="text-foreground font-medium text-lg shrink-0">
                  {product.data.currency}{product.data.price}
                </span>
              </div>

              <p class="text-muted-foreground leading-relaxed">
                {product.data.description}
              </p>
            </a>

            <button class="mt-4 w-full px-4 py-2.5 rounded-lg bg-foreground/5 border border-border text-headings font-medium transition-all duration-200 hover:bg-foreground hover:text-background hover:border-foreground">
              Get Instant Access
            </button>
          </article>
        ))}
      </div>

      {availableProducts.length === 0 && (
        <div class="py-12 text-center">
          <p class="text-muted-foreground">
            New products coming soon. Check back later!
          </p>
        </div>
      )}
    </div>
  </Container>

  <Container as='section' class='py-6'>
    <div class="flex flex-col gap-5">
      <span class="text-headings">Why I Made These</span>
      <div class="prose dark:prose-invert prose-sm">
        <p>
          After years of building systems for myself, I packaged the ones that made the biggest difference. These are the exact templates, frameworks, and resources I use to stay organized and focused.
        </p>
        <p>
          Each product is battle-testedâ€”refined through real use, not theory. They're designed for people who want to think clearly, work intentionally, and avoid the endless cycle of searching for the "perfect" tool.
        </p>
      </div>
    </div>
  </Container>
</BaseLayout>

<style>
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  article {
    animation: fadeIn 0.5s ease-out;
  }

  article:nth-child(1) {
    animation-delay: 0.05s;
  }

  article:nth-child(2) {
    animation-delay: 0.1s;
  }

  article:nth-child(3) {
    animation-delay: 0.15s;
  }

  article:nth-child(4) {
    animation-delay: 0.2s;
  }
</style>
